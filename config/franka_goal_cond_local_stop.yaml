
# GF-FM: Goal-Conditioned 2nd-order Flow Matching
# Configuration for Franka Panda robot with fixed start position

# Task and data
task: "Isaac-Reach-Franka-v0"
data_path: "/workspace/isaaclab/scripts/gf_fm/datasets/franka_goal_cond_local_stop.hdf5"

# Observation keys for conditioning
# - joint_pos, joint_vel are always included automatically
# - goal_q: goal joint configuration for goal-conditioned learning
obs_keys:
  - goal_q

# Fixed start configuration (Franka home position)
fixed_start: true
fixed_start_q: [0.0, -0.785, 0.0, -2.356, 0.0, 1.571, 0.785]

# Model architecture
model:
  # 2nd-order state dimensions
  joint_dim: 7              # Franka arm joints
  state_dim: 14             # [q, q_dot]
  action_dim: 14            # [q_dot, q_ddot] velocity field

  # Trajectory dimensions
  horizon: 8               # Trajectory length
  n_obs_steps: 2            # Observation history
  n_action_steps: 4         # Actions to execute

  # Encoder
  encoder_output_dim: 256   # State encoder output dim

  # UNet architecture
  diffusion_step_embed_dim: 256
  down_dims: [256, 512, 1024]
  kernel_size: 5
  n_groups: 8

  # Conditioning
  condition_type: "film"    # film, add, cross_attention
  use_down_condition: true
  use_mid_condition: true
  use_up_condition: true
  obs_as_global_cond: true

# Consistency Flow Matching hyperparameters
cfm:
  eps: 0.01                 # Minimum time
  num_segments: 2           # Time segments
  boundary: 1               # Velocity threshold
  delta: 0.01               # Consistency interval
  alpha: 0.00001            # Velocity loss weight
  num_inference_step: 10    # ODE integration steps
  eta: 0.01

# Normalization
normalization:
  mode: "limits"            # limits or gaussian
  output_max: 1.0
  output_min: -1.0

# Training
training:
  num_epochs: 3000           # Reduced for goal-conditioned (simpler task)
  batch_size: 512           # Smaller batch for faster iteration
  lr: 0.0001
  weight_decay: 0.0001
  num_workers: 4
  seed: 42

  # Logging
  log_dir: "./scripts/gf_fm/logs/goal_cond_stop"
  checkpoint_dir: "./scripts/gf_fm/logs/goal_cond_stop/checkpoints"
  log_freq: 200
  save_freq: 200

  # Device
  device: "cuda"

# GF Guidance (for inference) - disabled for pure policy testing
gf_guidance:
  enabled: false
  guidance_scale: 1.0
  max_strength: 5.0
  timestep: 0.01
  use_joint_limits: true
  use_body_repulsion: false
